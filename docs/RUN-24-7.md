# 在 Mac Mini 上让 GraceBot 持续运行（24/7）

## 一、用 PM2 跑起来（推荐）

项目里已经配好了 PM2，按下面做即可。

### 1. 安装 PM2（如未安装）

```bash
npm install -g pm2
# 或用 bun
bun add -g pm2
```

### 2. 启动 GraceBot

在项目根目录执行：

```bash
cd /Users/chenhao/Desktop/GraceBot
npm run pm2:start
# 或
pm2 start ecosystem.config.cjs
```

### 3. 开机自动启动（Mac 重启后也会自动跑）

```bash
# 保存当前进程列表
pm2 save

# 生成开机自启命令（会输出一段要你执行的命令）
pm2 startup
```

终端会提示类似（以你机器上实际输出的为准）：

```text
[PM2] To setup the Startup Script, copy/paste the following command:
sudo env PATH=$PATH:/opt/homebrew/... pm2 startup launchd -u chenhao --hp /Users/chenhao
```

**把 PM2 输出的整行 `sudo env PATH=...` 复制下来，在终端执行一次**（会要你输入 Mac 密码）。执行成功后，以后每次 Mac 开机都会自动用 PM2 拉起 GraceBot。

### 4. 常用命令

| 命令 | 说明 |
|------|------|
| `npm run pm2:logs` 或 `pm2 logs gracebot` | 看实时日志 |
| `pm2 status` | 看进程状态 |
| `pm2 restart gracebot` | 重启 |
| `npm run pm2:stop` 或 `pm2 stop gracebot` | 停止 |

---

## 二、可选：防止 Mac 休眠断网

如果 Mac Mini 会休眠，可能导致网络中断。可以：

1. **系统设置** → **电池**（或 **节能**）→ 关闭「使硬盘进入休眠」、调高「防止自动休眠」相关选项；若有「唤醒以供网络访问」可打开。
2. 用 **caffeinate** 临时防休眠（调试时用）：
   ```bash
   caffeinate -i pm2 start ecosystem.config.cjs
   ```
   长期 24/7 建议用上面系统设置，而不是长期依赖 caffeinate。

---

## 三、配置说明（ecosystem.config.cjs）

- **autorestart: true**：进程崩溃或退出后自动重启。
- **max_restarts: 10**：短时间连续重启超过 10 次会停止，避免异常死循环。
- **max_memory_restart: "512M"**：内存超过 512M 自动重启，防止内存泄漏拖垮机器。
- **watch: true**：监听项目代码变更，**改完代码保存后会自动重启**；只监听源码与配置，不监听 `node_modules`、`logs`、`data` 等，避免无谓重启。

按上述步骤做完后，GraceBot 会一直运行，掉线或崩溃会自动重启，Mac 重启后也会自动拉起。
